# 複数画像アップロード機能

## 実装内容

### 1. 最大5枚の画像アップロード
- 1投稿あたり最大5枚まで添付可能
- 複数選択での一括アップロード
- リアルタイムプレビュー

### 2. 自動画像圧縮・リサイズ
- **最大サイズ**: 1920x1920px
- **品質**: 75%（高品質）
- **アスペクト比**: 維持
- **フォーマット**: JPEG/PNG/WebP

### 3. レスポンシブグリッド表示
- **モバイル**: 1列
- **タブレット**: 2列
- **PC**: 3-4列（画面サイズに応じて）

### 4. 画像モーダル機能
- クリックで拡大表示
- 複数画像のスライド表示（前へ/次へボタン）
- 画像カウンター表示（例: 2/5）
- 背景にぼかし効果

## データベースの変更

SupabaseのSQL Editorで以下を実行:

```sql
-- update-posts-multiple-images.sql の内容を実行
ALTER TABLE posts ADD COLUMN IF NOT EXISTS image_urls TEXT[] DEFAULT '{}';

-- 既存データの移行
UPDATE posts 
SET image_urls = CASE 
  WHEN image_url IS NOT NULL THEN ARRAY[image_url] 
  ELSE '{}' 
END
WHERE image_urls IS NULL OR array_length(image_urls, 1) IS NULL;
```

## 使用方法

### 画像のアップロード
1. 「新しい投稿」ボタンをクリック
2. タイトル・内容を入力
3. 「画像を選択」をクリック
4. **Ctrlキー（Command）を押しながら画像を複数選択**
5. プレビューで確認（最大5枚）
6. 不要な画像は×ボタンで削除
7. 「投稿」ボタンをクリック

### 画像の閲覧
- **単一画像**: カードをクリックで拡大
- **複数画像**: 
  - グリッド表示（最大4枚）
  - カードをクリックで全画像をスライド表示
  - 前へ/次へボタンで画像を切り替え

## 圧縮効果

### 例
- **元の画像**: 5MB
- **圧縮後**: 約1-2MB
- **圧縮率**: 60-80%削減

### 最適化
- 自動リサイズ（1920px以下）
- 高品質圧縮（品質75%）
- アスペクト比維持
- サーバーストレージの削減

## 技術仕様

### 画像処理
- Canvas APIを使用したリサイズ
- 高品質なリサンプリング
- JPEG/PNG/WebP対応

### ストレージ
- Supabase Storage
- 公開URLでアクセス
- ユーザーごとのフォルダ構造

### 表示
- グラスモーフィズム効果
- グリッドレイアウト
- スライドモーダル

## トラブルシューティング

### 画像が表示されない
1. Supabaseのストレージポリシーを確認
2. ブラウザのコンソールでエラーを確認
3. 画像URLに直接アクセスして確認

### アップロードに失敗する
1. ファイルサイズを確認（5MB以下）
2. ファイル形式を確認（JPEG/PNG/WebP）
3. ネットワーク接続を確認

## ファイル構成

- `src/lib/storage.ts` - 画像アップロード・削除
- `src/lib/imageUtils.ts` - 画像圧縮処理
- `src/components/PostForm.tsx` - 複数画像選択
- `src/components/PostCard.tsx` - 複数画像表示・モーダル

