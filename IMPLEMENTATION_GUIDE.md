# エンハンスド社内掲示板 - 実装ガイド

## 実装された機能一覧

### ✅ 実装済み機能

1. **いいね機能**
   - 投稿にいいねが可能
   - いいね数の表示
   - すでにいいねしている投稿は解除可能

2. **コメント機能**
   - 投稿へのコメント投稿
   - コメント一覧の表示
   - 自分のコメントの削除
   - 管理者はすべてのコメントを削除可能

3. **人気投稿表示**
   - 日間・週間・月間の人気投稿が閲覧可能
   - いいね数とコメント数で人気度を算出

4. **社員のみがログイン可能**
   - ログイン時に社員チェックを実施
   - 社員でないユーザーはアクセス不可

5. **管理者によるユーザー招待**
   - 管理者が新規ユーザーを招待可能
   - 招待メール送信機能
   - 招待履歴の管理

## セットアップ手順

### 1. データベーススキーマの適用

SupabaseのダッシュボードのSQL Editorで以下を実行：

```sql
-- supabase-enhanced-schema.sql の内容を実行
```

主な変更点：
- `profiles`テーブルに`is_admin`、`is_employee`、`employee_id`、`department`カラムを追加
- `likes`テーブルを作成
- `comments`テーブルを作成
- `invitations`テーブルを作成
- 必要なポリシーとインデックスを設定

### 2. 初期データの設定

最初の管理者ユーザーを作成：

```sql
-- 既存のユーザーを管理者にする場合
UPDATE profiles
SET is_admin = TRUE, is_employee = TRUE
WHERE id = 'ユーザーID';
```

### 3. ストレージポリシーの確認

`post-images`バケットのポリシーが設定されていることを確認してください。

## 使用方法

### ユーザーとして

1. **ログイン** - 社員のみがログイン可能
2. **投稿の作成** - 写真付きの投稿が可能
3. **いいね** - 興味のある投稿にいいね
4. **コメント** - 投稿にコメントを追加
5. **人気投稿の閲覧** - 「人気投稿」タブから閲覧

### 管理者として

1. **管理者ログイン** - 管理者権限でログイン
2. **ユーザー招待** - 新規社員を招待
3. **ユーザー管理** - ユーザー一覧の確認・管理
4. **投稿管理** - 投稿の削除・管理

## テストと改善のフィードバックループ

### ① 相談フェーズ

導入企業との打ち合わせで以下を確認：

- [ ] 必要な機能はすべて実装されているか
- [ ] UI/UXに改善点はないか
- [ ] パフォーマンスに問題はないか
- [ ] セキュリティ要件を満たしているか

### ② テストフェーズ

以下のテストを実施：

#### 機能テスト
- [ ] ユーザー登録・ログイン機能
- [ ] 投稿の作成・編集・削除
- [ ] いいね機能
- [ ] コメント機能
- [ ] 人気投稿の表示
- [ ] 管理者機能

#### セキュリティテスト
- [ ] 社員以外のログイン試行
- [ ] 権限チェック
- [ ] データアクセス制御

#### パフォーマンステスト
- [ ] 投稿一覧の読み込み速度
- [ ] 画像アップロードの速度
- [ ] 同時アクセスの対応

### ③ 改善フェーズ

テスト結果に基づいて改善：

1. **バグ修正**
   - 発見されたバグを修正

2. **機能追加・改善**
   - ユーザー要望を反映
   - UI/UXの改善

3. **パフォーマンス最適化**
   - データベースクエリの最適化
   - キャッシュの導入

## 主なファイル構成

```
bulletin-board/
├── src/
│   ├── components/
│   │   ├── LikeButton.tsx          # いいねボタン
│   │   ├── CommentSection.tsx      # コメントセクション
│   │   ├── PopularPosts.tsx        # 人気投稿表示
│   │   ├── PostCard.tsx            # 投稿カード（更新）
│   │   └── admin/
│   │       └── InvitationForm.tsx  # ユーザー招待フォーム
│   ├── contexts/
│   │   └── AuthContext.tsx         # 認証（社員チェック追加）
│   └── app/
│       ├── page.tsx                # メインページ（人気投稿タブ追加）
│       └── admin/
│           └── page.tsx            # 管理者画面（招待タブ追加）
├── supabase-enhanced-schema.sql    # 拡張スキーマ
└── IMPLEMENTATION_GUIDE.md         # このファイル
```

## 今後の改善案

1. **通知機能** - いいねやコメント時の通知
2. **検索機能** - 投稿の検索
3. **フィルタ機能** - 部署・ユーザー別のフィルタ
4. **アプリ連携** - モバイルアプリの作成
5. **レポート機能** - 投稿の統計情報

## トラブルシューティング

### 問題: 社員がログインできない

**原因**: プロフィールに`is_employee = true`が設定されていない

**解決策**:
```sql
UPDATE profiles SET is_employee = TRUE WHERE id = 'ユーザーID';
```

### 問題: いいねボタンが動作しない

**原因**: データベースに`likes`テーブルが存在しない

**解決策**: `supabase-enhanced-schema.sql`を実行

### 問題: 管理者画面にアクセスできない

**原因**: プロフィールに`is_admin = true`が設定されていない

**解決策**:
```sql
UPDATE profiles SET is_admin = TRUE WHERE id = 'ユーザーID';
```

## サポート

問題が発生した場合は、以下を確認：

1. ブラウザのコンソールエラー
2. Supabaseのログ
3. データベースの状態

