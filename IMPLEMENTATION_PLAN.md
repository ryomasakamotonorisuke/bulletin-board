# 実装計画 - 大幅変更

## 現在の状況
- ✅ デプロイ成功（https://bulletin-board-omega-nine.vercel.app/）
- 📝 メールベース認証（Supabase Auth使用）
- 📝 ユーザーは自分でサインアップ可能
- 📝 管理者画面あり（CreateAdminForm, UserManagement, PostManagement, InvitationForm）

## 要求される変更

### 1. 認証システムの変更
- ❌ メールアドレス不要
- ✅ ユーザーIDとパスワードのみ
- ✅ 管理者のみがユーザーを作成
- ✅ 初回ログイン時にパスワード変更を強制
- ✅ ユーザー自己登録は無効化

### 2. 管理者画面の拡張
- ✅ ユーザー一覧にオンオフトグル（有効/無効）
- ✅ ユーザーのCSVエクスポート機能
- ✅ ユーザーのCSVインポート機能
- ✅ ダッシュボード画面（投稿数など）

### 3. ファイル整理
- 不要ファイルの削除
- エラーの修正
- デプロイ

---

## 実装方針

### オプションA: Supabase Authを維持（推奨）
**利点：**
- セキュリティが高い（Supabaseが管理）
- パスワードハッシュ化済み
- 実装が簡単

**変更点：**
1. メール認証を無効化（Supabase設定で）
2. ユーザーID（メールアドレスとして扱う）のみでログイン
3. 管理者のみがユーザー作成可能
4. 初回ログイン時のフラグを追加
5. profilesテーブルに is_active カラムを追加

### オプションB: 完全独自認証
**利点：**
- 完全にカスタマイズ可能

**問題点：**
- セキュリティの実装が必要（パスワードハッシュ化、セッション管理など）
- 開発時間が長い
- 既存のSupabase認証システムと完全に切り離す必要

---

## 推奨実装計画

**オプションAを推奨します。**

### 理由
1. セキュリティが確保されている
2. 開発時間が短い
3. 既存のコードとの整合性が高い
4. パスワード変更などの機能が既に実装されている

### 実装手順

#### ステップ1: データベース変更
- profilesテーブルに `user_id` カラムを追加（ユーザーID）
- profilesテーブルに `is_active` カラムを追加（オンオフ）
- profilesテーブルに `password_changed` カラムを追加（初回ログイン判定）

#### ステップ2: 認証システムの変更
- ログインフォームをユーザーIDとパスワードに変更
- メールアドレスの入力を削除
- 自己登録フォームを無効化

#### ステップ3: 管理者機能
- ユーザー作成フォーム（メールアドレスなし、ユーザーIDとパスワードのみ）
- ユーザー一覧にオンオフトグル追加
- CSVエクスポート機能
- CSVインポート機能
- ダッシュボード画面

#### ステップ4: 初回ログイン時のパスワード変更
- ログイン後に password_changed をチェック
- falseの場合、パスワード変更画面を強制表示
- パスワード変更後、password_changed を true に更新

#### ステップ5: ファイル整理
- 不要な.mdファイルの削除
- エラーの修正
- デプロイ

---

## 実装時間の見積もり
- ステップ1: 30分
- ステップ2: 1時間
- ステップ3: 2時間
- ステップ4: 30分
- ステップ5: 1時間
**合計: 約5時間**

---

## 確認事項
1. オプションAで実装して良いですか？
2. メールアドレスの入力欄は完全に削除して良いですか？
3. 既存のデータはどうしますか？（全て削除して再作成しますか？）

